<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Audio</title>
    <base href="/" />
    <link href="css/bootstrap/bootstrap.min.css" rel="stylesheet" />
    <link href="css/app.css" rel="stylesheet" />
    <link href="Blazor.Client.styles.css" rel="stylesheet" />
    <link href="manifest.json" rel="manifest" />
    <link rel="apple-touch-icon" sizes="512x512" href="icon-512.png" />
    <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png" />
</head>

<body>
    <div id="app">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">üóô</a>
    </div>
    <script src="_framework/blazor.webassembly.js"></script>
    <script>navigator.serviceWorker.register('service-worker.js');</script>

    <script src="js/jquery-3.6.0.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/app.js"></script>
    <script>


        //window.SoundJSMethods = {

        //    startRecording: function () {
        //        mediaRecorder.start();
        //        recording = true;
        //    },

        //    stopRecording: function (element) {
        //        mediaRecorder.stop();
        //        recording = false;
        //    },


        //};

        window.AudioContext = window.AudioContext || window.webkitAudioContext;
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º AudioContext.
        const audioCtx = new AudioContext();

        // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç, –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –º—ã –∏–ª–∏ –Ω–µ—Ç
        let recording = false;

        // –ó–∞–ø—Ä–æ—Å —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É.
        if (navigator.mediaDevices) {
            navigator.mediaDevices.getUserMedia(
                {
                    "audio": true
                }).then((stream) => {

                    // –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –º–µ–¥–∏–∞-—Ä–µ–∫–æ—Ä–¥–µ—Ä–∞
                    const mediaRecorder = new MediaRecorder(stream);

                    // –°–æ–∑–¥–∞–µ–º –±—É—Ñ–µ—Ä –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö.
                    let chunks = [];
                    mediaRecorder.ondataavailable = (event) => {
                        chunks.push(event.data);
                    }

                    // –ü—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–ø–∏—Å–∏, —Å–æ–∑–¥–∞–µ–º –ø—É—Å—Ç–æ–π –∞—É–¥–∏–æ–∫–ª–∏–ø.
                    mediaRecorder.onstop = (event) => {
                        const audio = new Audio();
                        audio.setAttribute("controls", "");
                        $("#sound-clip").append(audio);
                        $("#sound-clip").append("<br />");

                        // Combine the audio chunks into a blob, then point the empty audio clip to that blob.
                        const blob = new Blob(chunks,
                            {
                                "type": "audio/ogg; codecs=opus"
                            });
                        audio.src = window.URL.createObjectURL(blob);

                        //–û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–∞–π–ª –Ω–∞ API
                        var filename = "sound";
                        let fd = new FormData();
                        fd.append("file", blob, filename);
                        var xhr = new XMLHttpRequest();
                        //xhr.addEventListener("load", transferComplete);
                        //xhr.addEventListener("error", transferFailed)
                        //xhr.addEventListener("abort", transferFailed)
                        xhr.open("POST", "https://localhost:7029/api/Messages/Save/1", true);
                        xhr.send(fd);


                        //var fd=new FormData();
                        //fd.append("audio_data",blob, "filename.wav");
                        //xhr.open("POST","upload.php",true);
                        //xhr.send(fd);






                        // –û—á–∏—â–∞–µ–º –±—É—Ñ–µ—Ä –¥–ª—è –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π.
                        chunks = [];
                    };

                    window.SoundJSMethods = {

                        startRecording: function () {
                            mediaRecorder.start();
                            recording = true;
                        },

                        stopRecording: function (element) {
                            mediaRecorder.stop();
                            recording = false;
                        },


                    };
                    // –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–Ω–æ–ø–∫–∏ ¬´–ó–∞–ø–∏—Å—å¬ª.
                    //$("#record").on("click", () => {
                    //    if (recording) {
                    //        mediaRecorder.stop();
                    //        recording = false;
                    //        $("#record").html("Record");
                    //    }
                    //    else {
                    //        mediaRecorder.start();
                    //        recording = true;
                    //        $("#record").html("Stop");
                    //    }
                    //});

                }).catch((err) => {
                    // –ë—Ä–æ—Å–∞—Ç—å –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ, –∫–æ–≥–¥–∞ –±—Ä–∞—É–∑–µ—Ä –Ω–µ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É..
                    alert("–û, –Ω–µ—Ç! –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É –≤–∞—à–µ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞.");
                });
        }
        else {
            // –í—ã–¥–∞–≤–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –∫–æ–≥–¥–∞ –±—Ä–∞—É–∑–µ—Ä –Ω–µ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–∫–∏–º-–ª–∏–±–æ –º—É–ª—å—Ç–∏–º–µ–¥–∏–π–Ω—ã–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º.
            alert("–û, –Ω–µ—Ç! –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É –≤–∞—à–µ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ –≤–∞—à –±—Ä–∞—É–∑–µ—Ä.");
        }
    </script>
</body>

</html>



<!--https://dobrian.github.io/cmp/topics/sample-recording-and-playback-with-web-audio-api/voiceMemo.js
view-source:https://dobrian.github.io/cmp/topics/sample-recording-and-playback-with-web-audio-api/voiceMemo.html
https://dobrian.github.io/cmp/topics/sample-recording-and-playback-with-web-audio-api/voiceMemo.html
https://dobrian.github.io/cmp/topics/sample-recording-and-playback-with-web-audio-api/3.microphone-input-and-recording.html
https://developer.mozilla.org/en-US/docs/Web/API/MediaRecorder
https://mdn.github.io/web-dictaphone/scripts/app.js
https://mdn.github.io/web-dictaphone/scripts/app.js
https://mdn.github.io/web-dictaphone/styles/app.css
view-source:https://mdn.github.io/web-dictaphone/
https://mdn.github.io/web-dictaphone/
view-source:https://mdn.github.io/web-dictaphone/
https://mdn.github.io/web-dictaphone/
https://github.com/mattdiamond/Recorderjs/issues/188
https://www.google.com/search?q=web+audio+api+record+sound+blob+post+send+file&sxsrf=AOaemvJXiNrv1UmScL__cH0vFXToBs9ccA%3A1641385940263&ei=1I_VYbrZD-mxrgTbloPwAg&ved=0ahUKEwi6k6KPz5r1AhXpmIsKHVvLAC4Q4dUDCA4&uact=5&oq=web+audio+api+record+sound+blob+post+send+file&gs_lcp=Cgdnd3Mtd2l6EAMyBQghEKABOgcIIxCwAxAnOgcIABBHELADOgYIABAWEB46CQghEAoQoAEQKjoECCEQFToHCCEQChCgAToICCEQFhAdEB5KBAhBGABKBAhGGABQ6gZYqtcBYJ3aAWgEcAJ4AIAB3gGIAeIYkgEGMC4yMi4xmAEAoAEByAEJwAEB&sclient=gws-wiz-->
